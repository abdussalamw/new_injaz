<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙØ­Ø³Ù†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center mb-4">ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙØ­Ø³Ù†</h2>
        
        <div class="row">
            <div class="col-md-10 offset-md-1">
                
                <!-- Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
                <div class="test-section loading" id="test-main">
                    <h5>ğŸ“„ Ø§Ø®ØªØ¨Ø§Ø± 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h5>
                    <p id="main-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
                <div class="test-section loading" id="test-basic-api">
                    <h5>ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± 2: API Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h5>
                    <p id="basic-api-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
                <div class="test-section loading" id="test-status-filter">
                    <h5>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± 3: ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø©</h5>
                    <p id="status-filter-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù -->
                <div class="test-section loading" id="test-employee-filter">
                    <h5>ğŸ‘¤ Ø§Ø®ØªØ¨Ø§Ø± 4: ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù</h5>
                    <p id="employee-filter-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± ÙÙ„ØªØ±Ø© Ø§Ù„Ø¯ÙØ¹ -->
                <div class="test-section loading" id="test-payment-filter">
                    <h5>ğŸ’° Ø§Ø®ØªØ¨Ø§Ø± 5: ÙÙ„ØªØ±Ø© Ø§Ù„Ø¯ÙØ¹</h5>
                    <p id="payment-filter-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« -->
                <div class="test-section loading" id="test-search">
                    <h5>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± 6: Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ</h5>
                    <p id="search-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
                <div class="test-section loading" id="test-combined">
                    <h5>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± 7: Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</h5>
                    <p id="combined-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ -->
                <div class="test-section loading" id="test-unified">
                    <h5>âš™ï¸ Ø§Ø®ØªØ¨Ø§Ø± 8: Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯</h5>
                    <p id="unified-result">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
                </div>

                <!-- Ù†ØªÙŠØ¬Ø© Ø¹Ø§Ù…Ø© -->
                <div class="test-section info" id="final-result" style="display: none;">
                    <h4 class="text-center">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h4>
                    <div id="final-summary" class="text-center"></div>
                    <div id="detailed-results" class="mt-3"></div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const tests = [];
        let completedTests = 0;
        const totalTests = 8;

        function updateTestResult(testId, success, message, details = '') {
            const section = document.getElementById(testId);
            const result = document.getElementById(testId.replace('test-', '') + '-result');
            
            section.classList.remove('loading');
            if (success) {
                section.classList.add('success');
                result.innerHTML = 'âœ… ' + message;
            } else {
                section.classList.add('error');
                result.innerHTML = 'âŒ ' + message;
            }

            if (details) {
                result.innerHTML += '<br><small class="text-muted">' + details + '</small>';
            }

            tests.push({ name: testId, success: success, message: message, details: details });
            completedTests++;
            
            if (completedTests === totalTests) {
                showFinalResult();
            }
        }

        function showFinalResult() {
            const successCount = tests.filter(t => t.success).length;
            const finalSection = document.getElementById('final-result');
            const finalSummary = document.getElementById('final-summary');
            const detailedResults = document.getElementById('detailed-results');

            finalSection.style.display = 'block';
            
            if (successCount === totalTests) {
                finalSection.classList.add('success');
                finalSummary.innerHTML = `ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª (${successCount}/${totalTests})`;
            } else if (successCount >= totalTests * 0.75) {
                finalSection.classList.add('info');
                finalSummary.innerHTML = `âœ… Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! Ù…Ø¹Ø¸Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª (${successCount}/${totalTests})`;
            } else {
                finalSection.classList.add('error');
                finalSummary.innerHTML = `âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†Ø§Øª. Ù†Ø¬Ø­ ${successCount} Ù…Ù† ${totalTests} Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª`;
            }

            // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            let detailsHtml = '<h6>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h6><ul>';
            tests.forEach(test => {
                const icon = test.success ? 'âœ…' : 'âŒ';
                detailsHtml += `<li>${icon} ${test.name}: ${test.message}</li>`;
            });
            detailsHtml += '</ul>';
            detailedResults.innerHTML = detailsHtml;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        fetch('/dashboard.php')
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(data => {
                if (data.includes('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') || data.includes('dashboard')) {
                    updateTestResult('test-main', true, 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ØªØ­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    updateTestResult('test-main', false, 'Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
                }
            })
            .catch(error => {
                updateTestResult('test-main', false, 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 2: API Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        fetch('/api_tasks.php', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                if (data.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…') || data.includes('col-md-') || data.includes('alert')) {
                    updateTestResult('test-basic-api', true, 'API Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙŠØ¹Ù…Ù„');
                } else {
                    updateTestResult('test-basic-api', false, 'API Ø§Ù„Ù…Ù‡Ø§Ù… ÙŠØ±Ø¬Ø¹ Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹');
                }
            })
            .catch(error => {
                updateTestResult('test-basic-api', false, 'ÙØ´Ù„ ÙÙŠ API Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 3: ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        fetch('/api_tasks.php?status=Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                updateTestResult('test-status-filter', true, 'ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch(error => {
                updateTestResult('test-status-filter', false, 'ÙØ´Ù„ ÙÙŠ ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø©', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 4: ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù
        fetch('/api_tasks.php?employee=1', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                updateTestResult('test-employee-filter', true, 'ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch(error => {
                updateTestResult('test-employee-filter', false, 'ÙØ´Ù„ ÙÙŠ ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 5: ÙÙ„ØªØ±Ø© Ø§Ù„Ø¯ÙØ¹
        fetch('/api_tasks.php?payment=Ù…Ø¯ÙÙˆØ¹', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                updateTestResult('test-payment-filter', true, 'ÙÙ„ØªØ±Ø© Ø§Ù„Ø¯ÙØ¹ ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch(error => {
                updateTestResult('test-payment-filter', false, 'ÙØ´Ù„ ÙÙŠ ÙÙ„ØªØ±Ø© Ø§Ù„Ø¯ÙØ¹', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 6: Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
        fetch('/api_tasks.php?search=test', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                updateTestResult('test-search', true, 'Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch(error => {
                updateTestResult('test-search', false, 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 7: Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
        fetch('/api_tasks.php?status=Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…&employee=1&payment=ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹', {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
            .then(response => response.text())
            .then(data => {
                updateTestResult('test-combined', true, 'Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch(error => {
                updateTestResult('test-combined', false, 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', error.message);
            });

        // Ø§Ø®ØªØ¨Ø§Ø± 8: Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯
        fetch('/test_fixes.php')
            .then(response => response.text())
            .then(data => {
                if (data.includes('ğŸ† Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ÙÙ„ØªØ±Ø© ØªÙ… Ø­Ù„Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­')) {
                    updateTestResult('test-unified', true, 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ ÙŠØ¹Ù…Ù„ Ø¨ÙƒØ§Ù…Ù„ Ø·Ø§Ù‚ØªÙ‡');
                } else {
                    updateTestResult('test-unified', false, 'Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯');
                }
            })
            .catch(error => {
                updateTestResult('test-unified', false, 'ÙØ´Ù„ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯', error.message);
            });
    </script>
</body>
</html>
